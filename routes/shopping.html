<div class="page-header">
    <h2>Einkaufsliste</h2>
    <div class="page-header-actions" v-if="shoppingList.length > 0">
        <button class="secondary" :class="{ outline: !shoppingEditMode }" @click="shoppingEditMode = !shoppingEditMode">
            {{ shoppingEditMode ? 'Fertig' : 'Bearbeiten' }}
        </button>
        <button :class="{ outline: theme === 'dark' }" @click="shareShoppingList()">Teilen</button>
    </div>
</div>

<!-- Keine Einkaufsliste -->
<div v-if="shoppingList.length === 0 && !weekplan" class="empty-state">
    <p>Keine Einkaufsliste verfügbar.</p>
    <p>Erstelle zuerst einen Wochenplan!</p>
    <button class="mt-1" :class="{ outline: theme === 'dark' }" @click="navigateTo(1)">Zum Wochenplan</button>
</div>

<!-- Eintrag hinzufügen (nur im Edit-Mode) -->
<div v-if="shoppingEditMode" class="shopping-add">
    <form @submit.prevent="addShoppingItem()" role="group">
        <input type="text" v-model="newShoppingItem" placeholder="Eintrag hinzufügen...">
        <button type="button" v-if="speechEnabled" class="mic-btn" :class="{ active: speechListening && speechTarget === 'shopping' }" @click="toggleSpeechListening('shopping')" title="Spracheingabe">&#x1F3A4;</button>
        <button type="submit" :disabled="!newShoppingItem.trim()">+</button>
    </form>
    <div v-if="speechListening && speechTarget === 'shopping' && speechPartial" class="speech-partial">{{ speechPartial }}</div>
</div>

<!-- Einkaufsliste -->
<article v-if="shoppingList.length > 0">
    <div class="shopping-list">
        <div v-for="(item, index) in shoppingList" :key="index"
             class="item" :class="{ checked: item.checked, dragging: dragIndex === index }"
             :data-index="index"
             :draggable="shoppingEditMode"
             @dragstart="shoppingEditMode && onDragStart(index, $event)"
             @dragover="shoppingEditMode && onDragOver(index, $event)"
             @dragend="shoppingEditMode && onDragEnd($event)"
             @touchstart="shoppingEditMode && onTouchStart(index, $event)"
             @touchmove="shoppingEditMode && onTouchMove($event)"
             @touchend="shoppingEditMode && onTouchEnd()">

            <!-- Normal view -->
            <template v-if="editingShoppingIndex !== index">
                <span v-if="shoppingEditMode" class="drag-handle">&#x2630;</span>
                <input type="checkbox" :id="'item-' + index"
                       v-model="item.checked" @change="syncShoppingList(item)">
                <label :for="'item-' + index" class="ingredient-info" @dblclick="shoppingEditMode && startEditItem(index)">
                    <div>{{ item.name }}</div>
                    <div class="amount" v-if="item.amount || item.unit">{{ item.amount }} {{ item.unit }}</div>
                </label>
                <div v-if="shoppingEditMode" class="item-actions">
                    <button class="btn-icon" @click="startEditItem(index)" title="Bearbeiten">&#x270E;</button>
                    <button class="btn-icon btn-delete" @click="removeShoppingItem(index)" title="Löschen">&times;</button>
                </div>
            </template>

            <!-- Edit view -->
            <template v-else>
                <form class="item-edit-form" @submit.prevent="saveEditItem(index)">
                    <input type="text" v-model="editingShoppingText" placeholder="Name" class="edit-name" autofocus>
                    <input type="number" v-model="editingShoppingAmount" placeholder="Menge" class="edit-amount" step="any">
                    <input type="text" v-model="editingShoppingUnit" placeholder="Einheit" class="edit-unit">
                    <button type="submit" class="btn-icon" title="Speichern">&#x2713;</button>
                    <button type="button" class="btn-icon" @click="cancelEditItem()" title="Abbrechen">&times;</button>
                </form>
            </template>
        </div>
    </div>
</article>
