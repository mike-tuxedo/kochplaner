<div class="page-header">
    <h2>Einstellungen</h2>
</div>

<article class="settings-section">
    <h4>Darstellung</h4>
    <label>
        <input type="checkbox" role="switch" @change="toggleTheme()"/>
        {{ theme === 'light' ? 'â˜€ï¸ Light Mode' : 'ğŸŒ™ Dark Mode' }}
    </label>
    <label>
        <input type="checkbox" role="switch" :checked="bubblesEnabled" @change="toggleBubbles()"/>
        ğŸ«§ Hintergrund-Animation
    </label>
</article>

<article class="settings-section">
    <hgroup>
        <h4>Synchronisierung</h4>
        <p>VerschlÃ¼sselte Synchronisierung zwischen GerÃ¤ten.</p>
    </hgroup>

    <!-- State: Not configured -->
    <div v-if="syncState === 'none'" class="sync-setup">
        <button @click="startNewSync()" :disabled="syncLoading">
            <span v-if="syncLoading">Verbinde...</span>
            <span v-else>Neuen Sync starten</span>
        </button>
        <button class="secondary outline" @click="showImportKey()" :disabled="syncLoading">Mit bestehendem GerÃ¤t verbinden</button>
        <details class="mt-1">
            <summary>Erweiterte Einstellungen</summary>
            <label for="sync-server">Server-Adresse</label>
            <input type="text" id="sync-server" v-model="syncServerUrl" placeholder="wss://...">
        </details>
    </div>

    <!-- State: Import key -->
    <div v-if="syncState === 'importing'" class="sync-import">
        <p>Scanne den QR-Code vom anderen GerÃ¤t oder gib den SchlÃ¼ssel manuell ein.</p>
        <div class="settings-actions">
            <button @click="startQRScanner()" :disabled="syncLoading">QR-Code scannen</button>
        </div>
        <details class="mt-1" open>
            <summary>SchlÃ¼ssel manuell eingeben</summary>
            <input type="text" v-model="syncKeyInput" placeholder="SchlÃ¼ssel einfÃ¼gen..." autocomplete="off">
            <div class="settings-actions">
                <button class="secondary" @click="importSyncKey()" :disabled="syncLoading || !syncKeyInput.trim()">
                    <span v-if="syncLoading">Verbinde...</span>
                    <span v-else>Verbinden</span>
                </button>
            </div>
        </details>
        <details class="mt-1">
            <summary>Erweiterte Einstellungen</summary>
            <label for="sync-server-import">Server-Adresse</label>
            <input type="text" id="sync-server-import" v-model="syncServerUrl" placeholder="wss://...">
        </details>
        <button class="secondary outline mt-1" @click="syncState = 'none'">ZurÃ¼ck</button>
    </div>

    <!-- State: QR Scanner -->
    <div v-if="syncState === 'scanning'" class="sync-scanner">
        <div class="scanner-container">
            <video id="qr-video" muted playsinline></video>
            <div class="scanner-overlay"></div>
        </div>
        <button class="secondary outline" @click="cancelQRScanner()">Abbrechen</button>
    </div>

    <!-- State: Active -->
    <div v-if="syncState === 'active'" class="sync-active">
        <p class="sync-status">
            <span v-if="syncConnected" class="status-connected">â— Verbunden</span>
            <span v-else class="status-disconnected">â—‹ Nicht verbunden</span>
        </p>
        <p v-if="syncDecryptError" class="sync-error">EntschlÃ¼sselung fehlgeschlagen â€” falscher SchlÃ¼ssel?</p>
        <div class="settings-actions">
            <button @click="showShareKey()">Weiteres GerÃ¤t verbinden</button>
            <button class="secondary outline" @click="disableSync()">Sync deaktivieren</button>
        </div>
    </div>

    <!-- State: Share key -->
    <div v-if="syncState === 'sharing'" class="sync-share">
        <p>Scanne diesen QR-Code auf dem anderen GerÃ¤t unter <em>â€Mit bestehendem GerÃ¤t verbinden"</em>.</p>
        <div class="qr-display">
            <canvas id="qr-canvas"></canvas>
        </div>
        <div class="sync-key-display">
            <code class="sync-key-text">{{ syncKey }}</code>
        </div>
        <div class="settings-actions">
            <button @click="shareSyncKey()">Kopieren / Teilen</button>
            <button class="secondary outline" @click="backToSyncActive()">ZurÃ¼ck</button>
        </div>
    </div>
</article>

<article class="settings-section">
    <hgroup>
        <h4>Rezepte verwalten</h4>
        <p>Backups erstellen und wiederherstellen. Beim Import werden nur neue Rezepte hinzugefÃ¼gt.</p>
    </hgroup>
    <div class="settings-actions">
        <button class="secondary" @click="exportRecipes()">Exportieren</button>
        <label class="secondary" role="button">
            Importieren
            <input type="file" accept=".json" @change="importRecipes($event)" hidden>
        </label>
    </div>
</article>

<article class="settings-section">
    <hgroup>
        <h4>Vordefinierte Rezepte</h4>
        <p>Eine Vorauswahl an Rezepten importieren. Bestehende Rezepte bleiben erhalten.</p>
    </hgroup>
    <button class="secondary" @click="loadDefaultRecipes()">Standardrezepte laden</button>
</article>

<article class="settings-section" v-if="canInstall">
    <hgroup>
        <h4>App installieren</h4>
        <p>Installiere die App fÃ¼r schnelleren Zugriff und Offline-Nutzung.</p>
    </hgroup>
    <button @click="window.installApp()">App installieren</button>
</article>

<article class="settings-section danger-zone">
    <hgroup>
        <h4>Daten zurÃ¼cksetzen</h4>
        <p>Alle Rezepte und WochenplÃ¤ne werden unwiderruflich gelÃ¶scht.</p>
    </hgroup>
    <button class="secondary" @click="resetAllData()">Alle Daten lÃ¶schen</button>
</article>

<article class="settings-section">
    <h4>Ãœber die App</h4>
    <p>Kochplaner - Dein persÃ¶nlicher Wochenplaner</p>
    <small>Version 1.5 | Offline-fÃ¤hig | E2E-verschlÃ¼sselt</small>
</article>
