<div class="page-header">
    <h2>Einstellungen</h2>
</div>

<article class="settings-section">
    <h4>Darstellung</h4>
    <label>
        <input type="checkbox" role="switch" @change="toggleTheme()"/>
        {{ theme === 'light' ? '‚òÄÔ∏è Light Mode' : 'üåô Dark Mode' }}
    </label>
    <label>
        <input type="checkbox" role="switch" :checked="bubblesEnabled" @change="toggleBubbles()"/>
        ü´ß Hintergrund-Animation
    </label>
</article>

<article class="settings-section">
    <hgroup>
        <h4>Synchronisierung</h4>
        <p>Ende-zu-Ende verschl√ºsselte Synchronisierung zwischen mehreren Ger√§ten.</p>
    </hgroup>

    <!-- State: Not configured -->
    <div v-if="syncState === 'none'">
        <div class="input-group">
            <label for="sync-server">Server-Adresse</label>
            <input type="text" id="sync-server" v-model="syncServerUrl" placeholder="wss://kochplaner-server.mike.fm-media-staging.at">
        </div>
        <div class="settings-actions">
            <button @click="startNewSync()" :disabled="syncLoading">
                <span v-if="syncLoading">Verbinde...</span>
                <span v-else>Neue Sync starten</span>
            </button>
            <button class="secondary outline" @click="showImportKey()">Schl√ºssel importieren</button>
        </div>
    </div>

    <!-- State: Import key -->
    <div v-if="syncState === 'importing'">
        <div class="input-group">
            <label for="sync-server-import">Server-Adresse</label>
            <input type="text" id="sync-server-import" v-model="syncServerUrl" placeholder="wss://kochplaner-server.mike.fm-media-staging.at">
        </div>
        <div class="input-group">
            <label for="sync-key-input">Sync-Schl√ºssel</label>
            <input type="text" id="sync-key-input" v-model="syncKeyInput"
                   placeholder="Schl√ºssel einf√ºgen..." autocomplete="off">
        </div>
        <div class="settings-actions">
            <button @click="importSyncKey()" :disabled="syncLoading || !syncKeyInput.trim()">
                <span v-if="syncLoading">Verbinde...</span>
                <span v-else>Verbinden</span>
            </button>
            <button class="secondary" @click="startQRScanner()">QR scannen</button>
            <button class="secondary outline" @click="syncState = 'none'">Zur√ºck</button>
        </div>
    </div>

    <!-- State: QR Scanner -->
    <div v-if="syncState === 'scanning'" class="sync-scanner">
        <div class="scanner-container">
            <video id="qr-video" muted playsinline></video>
            <div class="scanner-overlay"></div>
        </div>
        <button class="secondary" @click="cancelQRScanner()">Abbrechen</button>
    </div>

    <!-- State: Active -->
    <div v-if="syncState === 'active'">
        <p class="sync-status">
            <span v-if="syncConnected" class="status-connected">‚óè Verbunden (verschl√ºsselt)</span>
            <span v-else class="status-disconnected">‚óã Nicht verbunden</span>
        </p>
        <p v-if="syncDecryptError" class="sync-error">Entschl√ºsselung fehlgeschlagen ‚Äî falscher Schl√ºssel?</p>
        <div class="settings-actions">
            <button class="secondary" @click="syncNow()" :disabled="!syncConnected">Jetzt synchronisieren</button>
            <button class="secondary" @click="showShareKey()">Schl√ºssel teilen</button>
            <button class="secondary outline" @click="disableSync()">Sync deaktivieren</button>
        </div>
    </div>

    <!-- State: Share key -->
    <div v-if="syncState === 'sharing'" class="sync-share">
        <div class="qr-display">
            <canvas id="qr-canvas"></canvas>
        </div>
        <div class="sync-key-display">
            <code class="sync-key-text">{{ syncKey }}</code>
        </div>
        <div class="settings-actions">
            <button @click="shareSyncKey()">Teilen / Kopieren</button>
            <button class="secondary outline" @click="backToSyncActive()">Zur√ºck</button>
        </div>
    </div>
</article>

<article class="settings-section">
    <hgroup>
        <h4>Rezepte verwalten</h4>
        <p>Hier kannst du Backups erstellen und wiederherstellen. Beim Import werden keine bestehenden Rezepte gel√∂scht, sondern nur neue hinzugef√ºgt.</p>
    </hgroup>
    <div class="settings-actions">
        <button class="secondary" @click="exportRecipes()">Exportieren</button>
        <label class="secondary" role="button">
            Importieren
            <input type="file" accept=".json" @change="importRecipes($event)" hidden>
        </label>
    </div>
</article>

<article class="settings-section">
    <hgroup>
        <h4>Vorderinierte Rezepte</h4>
        <p>Hier kannst eine von uns getroffene Vorauswahl an Rezepten importieren. Beim Import werden keine bestehenden Rezepte gel√∂scht, sondern nur neue hinzugef√ºgt.</p>
    </hgroup>
    <button class="secondary" @click="loadDefaultRecipes()">Standardrezepte laden</button>
</article>

<article class="settings-section" v-if="canInstall">
    <hgroup>
        <h4>App installieren</h4>
        <p>Installiere die App auf deinem Ger√§t f√ºr schnelleren Zugriff und Offline-Nutzung.</p>
    </hgroup>
    <button @click="window.installApp()">App installieren</button>
</article>

<article class="settings-section danger-zone">
    <hgroup>
        <h4>Daten zur√ºcksetzen</h4>
        <p>Alle Rezepte und Wochenpl√§ne werden unwiderruflich gel√∂scht.</p>
    </hgroup>
    <button class="secondary" @click="resetAllData()">Alle Daten l√∂schen</button>
</article>

<article class="settings-section">
    <h4>√úber die App</h4>
    <p>Kochplaner - Dein pers√∂nlicher Wochenplaner f√ºr Mahlzeiten</p>
    <small>Version 1.0 | Offline-f√§hig</small>
</article>
